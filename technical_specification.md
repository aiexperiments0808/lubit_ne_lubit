# Техническое задание для MVP приложения «Любит / не любит»
Версия: 1.0
Дата: 21 марта 2024 г.

## 1. Введение

Данное техническое задание описывает требования к первой версии (Minimum Viable Product - MVP) веб-приложения «Любит / не любит». Приложение предназначено для анализа истории переписки из мессенджера Telegram с использованием возможностей Gemini API от Google. Основная цель приложения - предоставить пользователю оценку и текстовый анализ его взаимоотношений, а также возможность задавать уточняющие вопросы в чате с искусственным интеллектом.

Для работы приложения необходимо экспортировать историю чата из Telegram с помощью приложения Telegram Desktop. Приложение «Любит / не любит» разрабатывается с приоритетом для использования на десктопных устройствах, однако пользовательский интерфейс должен быть адаптивным и корректно отображаться на различных размерах экранов, включая мобильные устройства. 

## 2. Основные функциональные требования

Приложение «Любит / не любит» должно обеспечивать следующие основные функции:

### 2.1. Загрузка файла с перепиской

- Пользователь должен иметь возможность выбрать файл с историей переписки из Telegram, хранящийся на его устройстве, используя стандартный диалог выбора файла, а также перетащить файл в специально отведенную область приложения (Drag and Drop).
- Приложение должно поддерживать файлы в форматах JSON и HTML. Рекомендуемым форматом является JSON.
- Максимальный размер загружаемого файла должен быть ограничен до 10 МБ.
- Приложение должно проверять формат и размер выбранного файла. В случае несоответствия формату или превышения размера, пользователю должно быть показано соответствующее сообщение об ошибке.
- При реализации Drag and Drop должна быть предусмотрена визуальная обратная связь для пользователя, например, изменение внешнего вида области перетаскивания при наведении файла и после его успешного сброса.

### 2.2. Анализ переписки с помощью Gemini API

- После успешной загрузки файла, его содержимое должно быть передано в Gemini API для анализа.
- При взаимодействии с Gemini API должен использоваться следующий системный промпт:

```
Ты - опытный психолог, анализирующий текстовую переписку. Тебе предоставлен текст переписки из Telegram. Твоя задача - проанализировать эту переписку и предоставить отчет о взаимоотношениях между участниками.

Твой ответ должен начинаться со строки "Оценка удовлетворенности: X/10", где X - это число от 1 до 10, отражающее твою оценку общего уровня удовлетворенности общением.

Далее предоставь текстовый отчет, включающий следующие аспекты:

- Общая оценка взаимоотношений между участниками переписки.
- Анализ относительной заинтересованности каждого участника в общении. Постарайся определить, кто проявляет больший интерес и как это проявляется.
- Перечисли наиболее часто обсуждаемые темы в переписке, с особым вниманием к темам, которые инициировал другой участник чата (не тот, чья переписка анализируется).
- Оцени общий эмоциональный тон общения (например, позитивный, негативный, нейтральный, дружеский, напряженный и т.д.).

Анализ должен быть проведен на русском языке.
```

- Ожидаемый ответ от Gemini API должен включать оценку удовлетворенности общением и текстовый отчёт, соответствующий структуре, заданной в промпте.

### 2.3. Взаимодействие в чате с Gemini API

- После отображения первоначального отчёта, пользователь должен иметь возможность задавать Gemini API уточняющие вопросы по результатам анализа через текстовый чат.
- При каждом последующем запросе в Gemini API должен передаваться контекст предыдущих сообщений в чате с использованием параметра history.

### 2.4. Отображение отчёта

- Первоначальный отчёт, полученный от Gemini API, должен быть отображен в окне чата в виде первого сообщения от LLM.
- Оценка удовлетворенности общением должна быть визуально представлена в начале этого первого сообщения с использованием символов псевдографики в формате прогрессбара (например, [███████░░░] (7/10)).

### 2.5. Реализация чата

- Приложение «Любит / не любит» должно предоставлять пользовательский интерфейс для ввода и отправки текстовых сообщений.
- Сообщения пользователя и LLM должны отображаться в окне чата в виде стилизованных "пузырьков", визуально отличающихся друг от друга.
- История чата должна сохраняться и обновляться на стороне клиента с использованием React.

### 2.6. Сохранение API-ключа

- Пользователь должен иметь возможность ввести свой API-ключ от Gemini API.
- Введенный API-ключ должен сохраняться в локальном хранилище браузера (localStorage) и использоваться для последующих сессий.

### 2.7. Инструкция по экспорту чата

- Над секцией загрузки файла должен быть размещен разворачивающийся блок (аккордеон) с заголовком "Как экспортировать чат из Telegram Desktop?".
- Внутри аккордеона должна отображаться текстовая инструкция по экспорту переписки из Telegram Desktop в форматах JSON или HTML.
- Также внутри аккордеона должно быть предусмотрено место для будущего GIF-изображения, иллюстрирующего процесс экспорта из Telegram Desktop.

### 2.8. Индикаторы загрузки

- Во время загрузки файла, а также при ожидании ответа от Gemini API (как при первоначальном анализе, так и в процессе чата), приложение должно отображать индикатор загрузки в виде нескольких плавно появляющихся и исчезающих анимированных точек. 

## 3. Требования к пользовательскому интерфейсу (UI) и пользовательскому опыту (UX)

Приложение «Любит / не любит» должно обладать интуитивно понятным и удобным пользовательским интерфейсом, разработанным с учетом адаптивности под различные экраны, с приоритетом для десктопных устройств.

### 3.1. Общая структура страниц

- Приложение должно быть реализовано как одностраничное веб-приложение (SPA).
- Основной контент должен быть организован в логической последовательности:
  - Блок с инструкцией по экспорту чата (аккордеон)
  - Секция для загрузки файла с перепиской
  - Окно чата для отображения отчёта и последующего взаимодействия
- Дизайн должен быть адаптивным и корректно отображаться на экранах различных размеров.

### 3.2. Чат

- Окно чата должно располагаться в нижней части экрана после секции загрузки файла.
- Сообщения пользователя должны отображаться в "пузырьках" с одной стороны (например, справа), а сообщения от LLM - с другой стороны (например, слева).
- Текст сообщений должен быть легко читаемым.
- Должны быть предусмотрены поля для ввода сообщения пользователем и кнопка "Отправить".

### 3.3. Отображение оценки удовлетворенности

- Оценка удовлетворенности общением должна отображаться в виде псевдографического прогрессбара в начале первого сообщения чата.
- Для корректного отображения символов псевдографики рекомендуется использовать моноширинный шрифт.
- Формат прогрессбара должен быть информативным и включать как визуальное представление (заполненные и пустые блоки), так и числовое значение оценки.

### 3.4. Инструкция по экспорту чата

- Блок с инструкцией должен быть реализован в виде аккордеона, который по умолчанию находится в свернутом состоянии.
- Заголовок аккордеона должен быть информативным ("Как экспортировать чат из Telegram Desktop?").
- При открытии аккордеона должна отображаться текстовая инструкция и плейсхолдер для будущего GIF-изображения.

### 3.5. Индикаторы загрузки

- Во время выполнения длительных операций должен отображаться индикатор загрузки.
- Индикатор загрузки должен быть расположен таким образом, чтобы пользователь понимал, какой именно процесс выполняется.

### 3.6. Область Drag and Drop

- В секции загрузки файла должна быть предусмотрена четко обозначенная область для Drag and Drop.
- Внешний вид этой области должен визуально отличаться от остального интерфейса.
- При наведении файла на эту область ее внешний вид должен меняться, сигнализируя о готовности к загрузке.
- После успешного перетаскивания файла и его загрузки пользователю должно быть показано соответствующее уведомление. 

## 4. Требования к обработке ошибок

Приложение «Любит / не любит» должно корректно обрабатывать различные ошибки, которые могут возникнуть в процессе его работы, и предоставлять пользователю понятную обратную связь.

### 4.1. Ошибки при загрузке файла

- Неподдерживаемый формат файла: "Неподдерживаемый формат файла. Пожалуйста, выберите файл в формате JSON или HTML."
- Файл слишком большого размера: "Файл слишком большой. Пожалуйста, выберите файл размером не более 10 МБ."
- Ошибка чтения файла: "Не удалось прочитать файл. Пожалуйста, попробуйте выбрать другой файл."
- Пустой или некорректный файл: "Загруженный файл пуст или не содержит корректных данных переписки."

### 4.2. Ошибки при взаимодействии с Gemini API

- Проблемы с сетью: "Произошла ошибка сети. Пожалуйста, проверьте ваше подключение к интернету и попробуйте позже."
- Недействительный API-ключ: "Недействительный API-ключ. Пожалуйста, проверьте ключ, который вы ввели."
- Превышение лимита запросов: "Превышен лимит запросов к API. Пожалуйста, попробуйте позже."
- Другие ошибки API: "Произошла ошибка при обработке запроса. Пожалуйста, попробуйте позже."
- Ошибка обработки ответа LLM: "Не удалось обработать ответ от LLM."

### 4.3. Общие требования к отображению ошибок

- Сообщения об ошибках должны быть понятными, лаконичными и написаны на языке пользователя.
- Следует избегать использования технических терминов, которые могут быть непонятны обычному пользователю.
- Сообщения об ошибках должны быть расположены рядом с тем элементом интерфейса, где произошла ошибка.

## 5. Технические требования

### 5.1. Фронтенд

- Приложение должно быть разработано с использованием библиотеки React (версия 18 или более поздняя).

### 5.2. Взаимодействие с Gemini API

- Для выполнения анализа переписки и обеспечения работы чата приложение должно взаимодействовать с Gemini API от Google, используя модель gemini-2.0-flash.
- Анализ: Содержимое загруженного файла должно передаваться в Gemini API вместе с заранее определенным системным промптом.
- Чат: Для поддержки контекста диалога при последующих вопросах пользователя необходимо использовать параметр history.
- Аутентификация: Для доступа к Gemini API должен использоваться API-ключ, введенный пользователем.

### 5.3. Локальное хранилище

- API-ключ пользователя должен быть сохранен в локальном хранилище браузера (localStorage).

### 5.4. Управление состоянием

- Для управления состоянием приложения необходимо использовать встроенные возможности React для управления состоянием (useState, useReducer).

### 5.5. Стилизация

- Для стилизации пользовательского интерфейса необходимо использовать CSS.
- При разработке стилей следует придерживаться принципа адаптивности под различные экраны.

## 6. Ограничения MVP

В данном разделе перечислены функции и возможности, которые не будут включены в первую версию приложения «Любит / не любит» (MVP):

- Поддерживаемые форматы файлов: Только JSON и HTML
- Максимальный размер файла: 10 МБ
- Язык анализа: Оптимизирован для русского языка
- Функциональность чата: Только базовая текстовая переписка
- Пользовательские аккаунты: Не предусмотрены
- Платформа: Приоритет для десктопных устройств
- Сообщения об успехе: Не предусмотрены
- Настройки и кастомизация: Не предусмотрены 